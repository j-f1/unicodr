<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <link rel="stylesheet" href="index.css" charset="utf-8">
    <script src="jquery.slim.min.js" charset="utf-8"></script>
  </head>
  <body>
    <header>
      <input class="search" placeholder="Search charactersâ€¦">
    </header>
  </body>

  <main></main>

  <script>
    // You can also require other files to run in this process
    // This file is required by the index.html file and will
    // be executed in the renderer process for that window.
    // All of the Node.js APIs are available in this process.

    const promisify = require('promisify-node');
    const python = promisify(require('python').shell);
    const path = require('path');
    const fs = promisify(require('fs'));

    class UniChar {
      constructor({name, code}) {
        this.name = name;
        this.code = code;
        this.char = String.fromCharCode(code);
      }
      get prettyCode() {
        var code = this.code.toString(16);
        while (code.length < 4) {
          code = "0" + code;
        }
        return "U+" + code;
      }
    }

    var loadUnicodeData = new Promise(function(resolve, reject) {
      let UNICODE_DATA = [];
      fs.readFile(path.join(__dirname, 'load.py'), 'utf-8').then(pythonCode => {
        python(pythonCode).then(json => {
          json = json.replace(/^Command Start\n/, '');
          var data = JSON.parse(json);
          data.forEach(charInfo => {
            let char = new UniChar(charInfo);
            UNICODE_DATA.push(char);
          });
          resolve(UNICODE_DATA);
        });
      }, err => {
        reject(err);
      });
    });
    loadUnicodeData.then(data => {
      window.UNICODE_DATA = data;
      var $main = $('main');
      UNICODE_DATA.forEach(char => {
        var $el = $(`<span class="item">
          <span class="char"></span>
          <span class="code"></span>
        </span>`);
        $el.children('.char').text(char.char);
        $el.children('.code').text(char.prettyCode);
        $main.append($el);
      });
    }, err => {throw err;});
  </script>
</html>
